# VTDR Theme Component Capability Contract v1

تاريخ الإصدار: 2026-02-19  
النطاق: ما الذي يجب تعريفه داخل الثيم لكي تعمل شاشة `مكونات الصفحات` بشكل صحيح، وكيف يتم ذلك بدون إدخال يدوي لكل ثيم داخل لوحة VTDR.

## 1) القرار التنفيذي

1. مصدر الحقيقة لمكونات الصفحات هو `twilight.json` داخل كل ثيم (`components[]`).
2. VTDR لا يجب أن يضيف مكونات يدويًا لكل ثيم من جهة النظام.
3. الإضافة اليدوية المسموح بها في لوحة VTDR هي فقط:
   - ترتيب المكونات.
   - تفعيل/تعطيل الظهور.
   - تعديل خصائص المكون (`props`) في `page_compositions`.
4. تعريف المكونات نفسها (الهوية/المسار/الحقول) يتم مرة واحدة داخل الثيم.

## 2) كيف يعمل التدفق فعليًا (As-Is)

1. API يقرأ `components` من `twilight.json` مباشرة عبر Theme Runtime Adapter.
2. شاشة `مكونات الصفحات` تبني الصفحات القابلة للتحرير من `component.path`.
3. إذا كانت كل المسارات `home.*` فلن تظهر إلا الصفحة الرئيسية في هذه الشاشة.

## 3) ما العناصر التي يجب إضافتها؟

الإجابة الدقيقة:  
لا توجد "قائمة عناصر ثابتة" تُضاف داخل VTDR لكل ثيم.  
المطلوب هو تعريف **Component Paths** داخل الثيم لكل صفحة تريد أن تصبح قابلة للتحكم من شاشة `مكونات الصفحات`.

## 4) مصفوفة المسارات القياسية (Page Path Prefixes)

الصفحات التالية هي المسارات القياسية التي يتعامل معها VTDR حاليًا.  
أي ثيم يريد دعم التحرير من شاشة المكونات يجب أن يحتوي مكونات بمسارات تبدأ بهذه الـprefixes:

| الصفحة في لوحة VTDR | Prefix المطلوب في `component.path` |
|---|---|
| الرئيسية | `home.*` |
| قائمة المنتجات | `product.*` |
| صفحة منتج مفرد | `product.single.*` أو `product.*` |
| صفحة التصنيف | `category.*` |
| السلة | `cart.*` |
| الملف الشخصي | `customer.profile.*` |
| طلبات العميل | `customer.orders.*` |
| المفضلة | `customer.wishlist.*` |
| الإشعارات | `customer.notifications.*` |
| قائمة المدونة | `blog.*` |
| مقالة مفردة | `blog.single.*` أو `blog.*` |
| قائمة الماركات | `brands.*` |
| ماركة مفردة | `brands.single.*` أو `brands.*` |
| صفحة الشكر | `thank-you.*` |
| صفحة هبوط | `landing-page.*` |
| صفحة ثابتة | `page-single.*` |

## 5) هل يجب إضافتها يدويًا لكل ثيم؟

1. داخل لوحة VTDR: لا.
2. داخل الثيم (`twilight.json`): نعم، مرة واحدة لكل ثيم.
3. بعد تعريفها داخل الثيم:
   - `POST /api/themes/sync` يكفي لاكتشافها.
   - VTDR يعرضها تلقائيًا في شاشة `مكونات الصفحات`.

## 6) الحالة الحالية لثيم `theme-raed-master`

الثيم الحالي يحتوي مسارات من نوع `home.*` فقط داخل `components[]`، لذلك شاشة `مكونات الصفحات` تقيد التحرير على الصفحة الرئيسية فقط.  
هذا سلوك صحيح وفق العقد الحالي، وليس خلل واجهة.

## 7) معيار قبول لأي ثيم جديد

لكي نقول إن الثيم "يدعم محرر مكونات الصفحات" في VTDR:

1. يعرّف `components[]` بمسارات تغطي الصفحات المستهدفة.
2. كل مكون لديه `key` فريد و`fields` صالحة.
3. `source` في حقول `items/dropdown-list` يطابق مصادر VTDR (`products`, `categories`, `brands`, `pages`, `blog_articles`, `blog_categories`, `offers`, `reviews`, `questions`).
4. بعد `themes/sync` تظهر الصفحات والمكونات تلقائيًا دون أي تعديل في كود VTDR.

## 8) قاعدة تشغيل مهمة

إذا كان ثيم لا يعرّف مكونات لصفحة معينة، فهذه الصفحة قد تعمل في المعاينة عبر Twig نفسها،  
لكنها لن تكون قابلة للتحكم من شاشة `مكونات الصفحات` حتى يتم تعريف مكوناتها داخل `twilight.json` لذلك الثيم.
